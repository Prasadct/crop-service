
doctype html(lang='en')
head
    meta(charset='utf-8')
    |     
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    |     
    meta(name='viewport', content='width=device-width, initial-scale=1')
    |     
    meta(name='description', content="CropAdvisor - Making Farmer's Life Easy")
    |     
    meta(name='author', content='')
    |     
    title CropAdvisor - Making Farmer&apos;s Life Easy
    // Bootstrap Core CSS
    link(href='../css/bootstrap.min.css', rel='stylesheet')
    // Custom CSS
    link(href='../css/landing-page.css', rel='stylesheet')
    // Custom Fonts
    link(href='../font-awesome/css/font-awesome.min.css', rel='stylesheet', type='text/css')
    |     
    link(href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic', rel='stylesheet', type='text/css')
    
    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
      script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
      |         
      script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
      
    script.
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-83002133-1', 'auto');
      ga('send', 'pageview');
    
  body
    // Navigation
    nav.navbar.navbar-default.navbar-fixed-top.topnav(role='navigation')
      .container.topnav
        // Brand and toggle get grouped for better mobile display
        .navbar-header
          button.navbar-toggle(type='button', data-toggle='collapse', data-target='#bs-example-navbar-collapse-1')
            span.sr-only Toggle navigation
            |                     
            span.icon-bar
            |                     
            span.icon-bar
            |                     
            span.icon-bar
          |                 
          a.navbar-brand.topnav(href='#') CropAdvisor
        // Collect the nav links, forms, and other content for toggling
        #bs-example-navbar-collapse-1.collapse.navbar-collapse
          ul.nav.navbar-nav.navbar-right
            li
              a(href='#about') Home
            |                     
            li
              a(href='#services') Services
            |                     
            li
              a(href='#contact') Contact
        // /.navbar-collapse
      // /.container
    // Header
    
    pre#json.
    .intro-forum
      h3 Questions from email
      
    #con

    tr
      td.text-center
        h4
          a(href='#') #{content}
          br
          small
            | Asked by #{name} | Contact no #{phone} | Address #{address} | District #{district}
      td
        video(src= '#{audio}', controls='')
          p
            | Your browser doesn't support HTML5 video. Here is a 
            a(href='#{audio}') link to the video
            |  instead.
      td.text-center.hidden-xs.hidden-sm
        a.btn.btn-primary(href='', role='button', data-toggle='modal', data-target='.bs-example-modal-lg', data-qid='#{qid}', data-qcontent= '#{content}', data-qimage= '#{image}') Answer
      td.text-center.hidden-xs.hidden-sm
        a.btn.btn-success(href='', role='button', data-toggle='modal', data-target='.view-query-modal-lg', data-qid= '#{qid}', data-qcontent= '#{content}', data-qimage= '#{image}') View Query

    
              
    #exampleModal.modal.fade.bs-example-modal-lg(tabindex='-1', role='dialog', aria-labelledby='myLargeModalLabel')
      .modal-dialog.modal-lg
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              button.close(type='button', data-dismiss='modal', aria-label='Close')
                span(aria-hidden='true') ×
              h4#exampleModalLabel.modal-title Query
              img#modalimage.img-responsive(src='', alt='')
            .modal-body
              form
                .form-group
                  h4 Response
                  h3#exampleModalLabel.res-modal-res Response
                p#qv-response.qvmr 
                .form-group
                  input#modalqid(type='hidden', name='qid')
                  label.control-label(for='agent-username') Username:
                  input#agent-username.form-control(type='text')
                  label.control-label(for='agent-password') Password:
                  input#agent-password.form-control(type='password')
                .form-group
                  label.control-label(for='message-text') Response:
                  textarea#message-text.form-control
            .modal-footer
              button.btn.btn-default(type='button', data-dismiss='modal') Close window
              button#sendresponse.btn.btn-primary(type='button') Send response
              
    #successalertmodal.modal.fade.bs-successalert-modal-lg(tabindex='-1', role='dialog', aria-labelledby='successAlertModal')
      .modal-dialog.modal-lg
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              .alert.alert-success(role='alert') Response successfuly updated 
              
    #serroralertmodal.modal.fade.bs-erroralert-modal-lg(tabindex='-1', role='dialog', aria-labelledby='errorAlertModal')
      .modal-dialog.modal-lg
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              .alert.alert-danger(role='alert') You are not allowed to respond to this query!           
    
    #viewQueryModel.modal.fade.view-query-modal-lg(tabindex='-1', role='dialog', aria-labelledby='myLargeModalLabel')
      .modal-dialog.modal-lg
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              button.close(type='button', data-dismiss='modal', aria-label='Close')
                span(aria-hidden='true') ×
              h4#exampleModalLabel.modal-title Query
              img#vmodalimage.img-responsive(src='', alt='')
            .modal-body
              form
                .form-group
                  input#vmodalqid(type='hidden', name='qid')
                  h4 Response
                  h3#exampleModalLabel.modal-res Response
                p#qv-response.qvmr 
            .modal-footer
              button.btn.btn-default(type='button', data-dismiss='modal') Close window
 
    // Footer
    footer
      .container
        .row
          .col-lg-12
            ul.list-inline
              li
                a(href='#') Home
              |                         
              li.footer-menu-divider &sdot;
              |                         
              li
                a(href='#about') About
              |                         
              li.footer-menu-divider &sdot;
              |                         
              li
                a(href='#services') Services
              |                         
              li.footer-menu-divider &sdot;
              |                         
              li
                a(href='#contact') Contact
        // /.navbar-collapse
            |                     
            p.copyright.text-muted.small Copyright &copy; CropAdvisor 2016. All Rights Reserve
      
    // jQuery
    script(src='../js/jquery.js')
    // Bootstrap Core JavaScript
    script(src='../js/bootstrap.min.js')
    
    script(type='text/javascript').
        $( document ).ready(function() {
        
        });
        
        function replaceAll(str) {
            if (str){
                return str.replace(/%20/g, ' ');
            } else {
                return '--';
            }
        }
        String.prototype.replaceAll = function(search, replace)
            {
                //if replace is not sent, return original string otherwise it will
                //replace search string with 'undefined'.
                if (replace === undefined) {
                    return this.toString();
                }

                return this.replace(new RegExp('[' + search + ']', 'g'), replace);
            };
        $('#exampleModal').on('show.bs.modal', function (event) {
          var button = $(event.relatedTarget) // Button that triggered the modal
          var recipient = button.data('qcontent') // Extract info from data-* attributes
          var queryimage = button.data('qimage')
          var queryid = button.data('qid')
          // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
          // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
          
          $.post("http://www.cropadvisor.site/uploads/getresponse",
                {
                  id: queryid
                },
                function(data,status){
                
                    modal.find('.res-modal-res').empty()
                   console.log(data);
                   if(data.length == 0){
                    modal.find('.res-modal-res').text(' ')
                   }
                   for( var i=0; i < data.length; i++){
                        modal.find('.res-modal-res').append('</br>')
                        modal.find('.res-modal-res').append('</br>')
                        modal.find('.res-modal-res').append('<span class=\'glyphicon glyphicon-grain\' aria-hidden=\'true\'></span>')
                        modal.find('.res-modal-res').append(' '+data[i].response)
                   }
                });
          
          var modal = $(this)
          modal.find('.modal-title').text('Query - ' + recipient)
          $("#modalqid").val(queryid);
          $('#modalimage').attr('src',''+queryimage);
        })    
        
        $(document).ready(function(){
            $("#sendresponse").click(function(){
            var id = $('#modalqid').val();
            var un = $('#agent-username').val();
            var pass = $('#agent-password').val();
            var resp = $('#message-text').val();
                $.post("http://www.cropadvisor.site/uploads/updateresponse",
                {
                  id: id,
                  username: un,
                  password: pass,
                  response: resp
                },
                function(data,status){
                    if(data.response == 'OK'){
                    $('#successalertmodal').modal('show');
                    $('#exampleModal').modal('hide');
                    } else {
                        $('#serroralertmodal').modal('show');
                    }
                });
            });
        });
        
        $('#viewQueryModel').on('show.bs.modal', function (event) {
          var button = $(event.relatedTarget) // Button that triggered the modal
          var recipient = button.data('qcontent') // Extract info from data-* attributes
          var queryimage = button.data('qimage')
          var queryid = button.data('qid')
          // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
          // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
          
          $.post("http://www.cropadvisor.site/uploads/getresponse",
                {
                  id: queryid
                },
                function(data,status){
                    modal.find('.modal-res').empty()
                   console.log(data);
                   if(data.length == 0){
                    modal.find('.modal-res').text(' ')
                   }
                   for( var i=0; i < data.length; i++){
                        modal.find('.modal-res').append('</br>')
                        modal.find('.modal-res').append('</br>')
                        modal.find('.modal-res').append('<span class=\'glyphicon glyphicon-grain\' aria-hidden=\'true\'></span>')
                        modal.find('.modal-res').append(' '+data[i].response)
                   }
                });
          
          var modal = $(this)
          modal.find('.modal-title').text('Query - ' + recipient)
          $("#vmodalqid").val(queryid);
          $('#vmodalimage').attr('src',''+queryimage);
        })    
    
